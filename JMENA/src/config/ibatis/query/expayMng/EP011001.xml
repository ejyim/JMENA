<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="EP011001">
	<typeAlias alias="EP011001VO" type="kr.co.jmena.www.web.home.expayMng.Vo.EP011001VO"/>


	
	<resultMap id="EP011001Data" class="EP011001VO">
		<result property="PAYDATE"					column="PAYDATE"/>
		<result property="SALERCD"					column="SALERCD"/>
		<result property="SALERNM"					column="SALERNM"/>
		<result property="SELLAMT"					column="SELLAMT"/>
		<result property="PAYAMT"					column="PAYAMT"/>
		<result property="TAXAMT"					column="TAXAMT"/>
		<result property="DEDUCTAMT"				column="DEDUCTAMT"/>
	
		<result property="SALEDATE"					column="SALEDATE"/>
		<result property="SALEID"					column="SALEID"	/>
		<result property="SALEGUBUN"				column="SALEGUBUN"/>
		<result property="BRANCHCODE"				column="BRANCHCODE"/>		
		<result property="MANAGENO"					column="MANAGENO"/>
		<result property="CITYCODE"					column="CITYCODE"/>
		<result property="ADDRESS"					column="ADDRESS"/>
		<result property="CONNAME"					column="CONNAME"	/>
		<result property="CONM2"					column="CONM2"/>
		<result property="CONPY"					column="CONPY"/>
		<result property="SALEAMT"					column="SALEAMT"/>
		<result property="SALEDANGA"				column="SALEDANGA"/>
		<result property="DCGUBUN"					column="DCGUBUN"/>
		<result property="DCRATE"					column="DCRATE"/>
		<result property="DCAMT"					column="DCAMT"/>
		<result property="SELLAMT"					column="SELLAMT"/>
		<result property="SUDANGRATE"				column="SUDANGRATE"/>
		<result property="ADDRATE"					column="ADDRATE"/>
		<result property="TAXGUBUN"					column="TAXGUBUN"/>
		<result property="TAXINCOME"				column="TAXINCOME"/>
		<result property="TAXLOCAL"					column="TAXLOCAL"/>
		<result property="SUPPLYTAX"				column="SUPPLYTAX"/>
		<result property="REMARK"					column="REMARK"/>
		
	</resultMap>

	<resultMap id="EP011001Datas" class="EP011001VO">
		<result property="SALEID"					column="SALEID"	/>
		<result property="PAYSEQ"					column="PAYSEQ"/>
		<result property="REGISTERSEQ"				column="REGISTERSEQ"/>		
		<result property="PAYERNAME"				column="PAYERNAME"/>
		<result property="PAYERID"					column="PAYERID"/>
		<result property="GRADE"					column="GRADE"/>
		<result property="DUTY"						column="DUTY"/>
		<result property="SUDANGRATE"				column="SUDANGRATE"/>
		<result property="ADDRATE"					column="ADDRATE"/>
		<result property="PAYAMT"					column="PAYAMT"/>
		<result property="TAXGUBUN"					column="TAXGUBUN"/>
		<result property="TAXINCOME"				column="TAXINCOME"/>
		<result property="TAXLOCAL"					column="TAXLOCAL"/>
		<result property="SUPPLYTAX"				column="SUPPLYTAX"/>
		<result property="DEDUCTAMT"				column="DEDUCTAMT"/>
		<result property="BANKID"					column="BANKID"/>
		<result property="ACCTNO"					column="ACCTNO"/>
		<result property="ACCTOWNER"				column="ACCTOWNER"/>
		<result property="PAYNUM"					column="PAYNUM"/>
		<result property="REMARK"					column="REMARK"/>				
	</resultMap>
	
	<resultMap id="EP011001DataSaleSudang" 			class="EP011001VO">
		<result property="SALEDATE"					column="SALEDATE"/>
		<result property="SALEID"					column="SALEID"	/>
		<result property="SALERNM"					column="SALERNM"/>		
		<result property="SALEAMT"					column="SALEAMT"/>
		<result property="CONNAME"					column="CONNAME"/>
		<result property="SALEGUBUN"				column="SALEGUBUN"/>
		<result property="CONNAME"					column="CONNAME"/>
		<result property="SALERCD"					column="SALERCD"/>
		<result property="BRANCHCODE"				column="BRANCHCODE"/>
		<result property="MANAGENO"					column="MANAGENO"/>
		<result property="CITYCODE"					column="CITYCODE"/>
		<result property="ADDRESS"					column="ADDRESS"/>
		<result property="CONM2"					column="CONM2"/>
		<result property="CONPY"					column="CONPY"/>
		<result property="SALEAMT"					column="SALEAMT"/>
		<result property="SALEDANGA"				column="SALEDANGA"/>
		<result property="DCGUBUN"					column="DCGUBUN"/>
		<result property="DCRATE"					column="DCRATE"/>
		<result property="DCAMT"					column="DCAMT"/>
		<result property="SELLAMT"					column="SELLAMT"/>
	</resultMap>
	



	<select id="selectListEnaSudangMst" resultMap="EP011001Data">
<!-- 	  SELECT SALEDATE,
	         T1.SALEID,
	         SALEGUBUN,         
			 BRANCHCODE,
	         (SELECT MANAGENO FROM mm_buymst WHERE BUYID = T3.BUYID) AS MANAGENO, 
	         (SELECT CITYCODE FROM mm_buymst WHERE BUYID = T3.BUYID) AS CITYCODE,
			 (SELECT ADDRESS FROM mm_buymst WHERE BUYID = T3.BUYID) AS ADDRESS,
	         CONNAME,
	         CONM2,
	         CONPY,
	         SALEAMT,
			 SALEDANGA,
	         DCGUBUN,
	         DCRATE,
	         DCAMT,
	         SELLAMT,
	         T1.REMARK
	    FROM sa_sudangmst T1, sa_sudangpayertb T2, sa_salemst T3, sa_saledtl T4
	   WHERE 1 = 1
	     AND T1.SALEID = T2.SALEID
		 AND T1.SALEID = T3.SALEID
		 AND T3.SALEID = T4.SALEID
	ORDER BY T1.SALEID ASC, T1.PAYSEQ -->
	
	  SELECT PAYDATE,
	  		 '00000001' AS SALERCD, 
	  		 '홍길동' AS SALERNM,
	  		 (SELECT SELLAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SELLAMT,
<!--  	  		 (SELECT SALERCD FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALERCD, 
	  		 (SELECT KNAME FROM sa_salemst s, hr_insamst i WHERE s.SALEID = T1.SALEID AND s.SALERCD = i.INSACODE) AS SALERNM, -->
	  		 T1.PAYAMT,
	  		 '1' AS TAXAMT,
	  		 T1.DEDUCTAMT,
	  		 <!-- (SELECT SALEDATE FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALEDATE, -->
	  		 '2017-11-11' AS SALEDATE,
	         T1.SALEID,
	         (SELECT SALEGUBUN FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALEGUBUN,         
			 BRANCHCODE,
	         '1' AS MANAGENO,
			 '1' AS  CITYCODE,
			 '1' AS  ADDRESS,
	         (SELECT CONNAME FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONNAME,
			 (SELECT CONM2 FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONM2,
			 (SELECT CONPY FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONPY,
	         (SELECT SALEAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEAMT,
			 (SELECT SALEDANGA FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEDANGA,
	         (SELECT DCGUBUN FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCGUBUN,
	         (SELECT DCRATE FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCRATE,
	         (SELECT DCAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCAMT,
	         (SELECT SELLAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SELLAMT,
	         T1.SUDANGRATE,
	         T1.ADDRATE,
	         T1.TAXGUBUN,
	         T1.TAXINCOME,
	         T1.TAXLOCAL,
	         T1.SUPPLYTAX,
	         T1.REMARK
	    FROM sa_sudangmst T1, sa_sudangpayertb T2
	   WHERE 1 = 1
	     AND T1.SALEID = T2.SALEID
	ORDER BY T1.SALEID ASC, T1.PAYSEQ
		</select>		
		
		
	
	<update id="updateEnaSudangMst">
		UPDATE sa_sudangmst
		SET
			INSACODE = #INSACODE#,
			BRANCHCODE = #BRANCHCODE#,
			DEPTCODE = #DEPTCODE#,
			GRADE = #GRADE#,
			DUTY = #DUTY#,
			PAYDATE = #PAYDATE#,
			SUDANGRATE = #SUDANGRATE#,
			ADDRATE = #ADDRATE#,
			PAYAMT = #PAYAMT#,
			TAXGUBUN = #TAXGUBUN#,
			TAXINCOME = #TAXINCOME#,
			TAXLOCAL = #TAXLOCAL#,
			SUPPLYTAX = #SUPPLYTAX#,
			DEDUCTAMT = #DEDUCTAMT#,
			REMARK = #REMARK#,
			UPDATEUSER = #UPDATEUSER#,
			UPDATEDATE = SYSDATE()
		WHERE SALEID  = #SALEID#
		AND PAYSEQ = #PAYSEQ#
	</update>
	
	<insert id="insertEnaSudangMst">
		INSERT INTO sa_sudangmst
		(
			SALEID,
			PAYSEQ,
			INSACODE,
			BRANCHCODE,
			DEPTCODE,
			GRADE,
			DUTY,
			PAYDATE,
			SUDANGRATE,
			ADDRATE,
			PAYAMT,
			TAXGUBUN,
			TAXINCOME,
			TAXLOCAL,
			SUPPLYTAX,
			DEDUCTAMT,
			REMARK,
			INSERTUSER,
			INSERTDATE
		)
		VALUES(
			#SALEID#,
			(SELECT IFNULL(MAX(PAYSEQ),0) +1 FROM sa_sudangmst s WHERE SALEID = #SALEID#),
			#INSACODE#,
			(SELECT BRANCHCODE FROM hr_insamst WHERE INSACODE = #INSACODE#) AS BRANCHCODE,
			(SELECT DEPTCODE FROM hr_insamst WHERE INSACODE = #INSACODE#) AS DEPTCODE,
			(SELECT GRADE FROM hr_insamst WHERE INSACODE = #INSACODE#) AS GRADE,
			(SELECT DUTY FROM hr_insamst WHERE INSACODE = #INSACODE#) AS DUTY,
			(SELECT BRANCHCODE FROM hr_insamst WHERE INSACODE = #INSACODE#) AS BRANCHCODE,
			#PAYDATE#,
			#SUDANGRATE#,
			#ADDRATE#,
			#PAYAMT#,
			#TAXGUBUN#,
			#TAXINCOME#,
			#TAXLOCAL#,
			#SUPPLYTAX#,
			#DEDUCTAMT#,
			#REMARK#,
			'admin',
			SYSDATE()
		)
	</insert>
	
	<select id="selectListEnaSudangPTb" resultMap="EP011001Datas">
		SELECT 
			T1.SALEID,
			T1.PAYSEQ,
			T1.REGISTERSEQ,
			T1.PAYERNAME,
			T1.PAYERID,
			T1.PAYAMT,
			(SELECT GRADE FROM hr_insamst WHERE JUMINID = T1.PAYERID ) AS GRADE,
			(SELECT DUTY FROM hr_insamst WHERE JUMINID = T1.PAYERID ) AS DUTY,
			(SELECT SUDANGRATE FROM sa_sudangmst WHERE SALEID = T1.SALEID) AS SUDANGRATE,
			(SELECT ADDRATE FROM sa_sudangmst WHERE SALEID = T1.SALEID) AS ADDRATE,
			T1.TAXGUBUN,
			T1.TAXINCOME,
			T1.TAXLOCAL,
			T1.SUPPLYTAX,
			T1.DEDUCTAMT,
			T1.BANKID,
			T1.ACCTNO,
			T1.ACCTOWNER,
			T1.REMARK,
			(SELECT MAX(REGISTERSEQ) FROM sa_sudangpayertb T2 WHERE T1.SALEID = T2.SALEID AND T1.PAYSEQ = T2.PAYSEQ) AS PAYNUM
		FROM sa_sudangpayertb T1
		WHERE 1=1
<!-- 		AND T1.SALEID = #SALEID#
		AND T1.PAYSEQ = #PAYSEQ#
		AND T1.REGISTERSEQ = #REGISTERSEQ# -->
		ORDER BY T1.REGISTERSEQ DESC
	</select>
	
	<update id="updateEnaSudangPTb">
		UPDATE sa_sudangpayertb
		SET
			PAYERNAME = #PAYERNAME#,
			PAYERID = #PAYERID#,
			PAYAMT = #PAYAMT#,
			TAXGUBUN = #TAXGUBUN#,
			TAXINCOME = #TAXINCOME#,
			TAXLOCAL = #TAXLOCAL#,
			SUPPLYTAX = #SUPPLYTAX#,
			DEDUCTAMT = #DEDUCTAMT#,
			BANKID = #BANKID#,
			ACCTNO = #ACCTNO#,
			ACCTOWNER = #ACCTOWNER#,
			REMARK = #REMARK#,
			UPDATEUSER = #UPDATEUSER#,
			UPDATEDATE = # UPDATEDATE#
		WHERE T1.SALEID = #SALEID#
		AND T1.PAYSEQ = #PAYSEQ#
		AND T1.REGISTERSEQ = #REGISTERSEQ#
	</update>
	
	<insert id="insertEnaSudangPTb">
		INSERT INTO sa_sudangpayertb
		(
			SALEID,
			PAYSEQ,
			REGISTERSEQ,
			PAYERNAME,
			PAYERID,
			PAYAMT,
			TAXGUBUN,
			TAXINCOME,
			TAXLOCAL,
			SUPPLYTAX,
			DEDUCTAMT,
			BANKID,
			ACCTNO,
			ACCTOWNER,
			REMARK,
			INSERTUSER,
			INSERTDATE
		)
		VALUES(
			#SALEID#,
			#PAYSEQ#,
			#REGISTERSEQ#,
			#PAYERNAME#,
			#PAYERID#,
			#PAYAMT#,
			#TAXGUBUN#,
			#TAXINCOME#,
			#TAXLOCAL#,
			#SUPPLYTAX#,
			#DEDUCTAMT#,
			#BANKID#,
			#ACCTNO#,
			#ACCTOWNER#,
			#REMARK#,
			#INSERTUSER#,
			SYSDATE()
		)
	</insert>
	
	<select id="selectListEnaSaleSudangList" resultMap="EP011001DataSaleSudang">
		SELECT 
			T1.SALEDATE,
			T1.SALEID,
			(SELECT KNAME FROM hr_insamst WHERE INSACODE = T1.SALERCD) AS SALERNM,
			(SELECT SALEAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEAMT,
			T1.CONNAME,
			T1.SALEGUBUN,
			SALERCD,
			'001' AS BRANCHCODE, <!-- 계약지사 -->
			'1' AS MANAGENO,
			'1' AS CITYCODE,
			'1' AS ADDRESS,
			T1.CONNAME,
			T1.CONM2,
			T1.CONPY,
			(SELECT SALEAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEAMT,
			(SELECT SALEDANGA FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEDANGA,
        	(SELECT DCGUBUN FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCGUBUN,
         	(SELECT DCRATE FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCRATE,
       	  	(SELECT DCAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCAMT,
       	  	(SELECT SELLAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SELLAMT
   		FROM sa_salemst T1
		WHERE 1=1
<!-- 		AND T1.SALEID = #SALEID#
		AND T1.PAYSEQ = #PAYSEQ#
		AND T1.REGISTERSEQ = #REGISTERSEQ# 
		ORDER BY T1.REGISTERSEQ DESC -->
	</select>	
	
	
	
</sqlMap>