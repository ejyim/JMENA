<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="SA012012">
	<typeAlias alias="SA012012VO" type="kr.co.jmena.www.web.home.saleMng.Vo.SA012012VO"/>
	
	<resultMap class="SA012012VO" id="SA012012Data">
		<result property="SALEID" column="SALEID"/>
		<result property="SALEDATE" column="SALEDATE"/>
		<result property="SALEGUBUN" column="SALEGUBUN"/>
		<result property="SALEGUBUNNAME" column="SALEGUBUNNAME"/>
		<result property="SALERCD" column="SALERCD"/>
		<result property="CONNAME" column="CONNAME"/>		
		<result property="CONM2" column="CONM2"/>
		<result property="CONPY" column="CONPY"/>
		<result property="SALEDANGA" column="SALEDANGA"/>
		<result property="SELLAMT" column="SELLAMT"/>
		<result property="AGENCYAMT" column="AGENCYAMT"/>
		
		
		<result property="CITYCODE" column="CITYCODE"/>
		<result property="CITYNAME" column="CITYNAME"/>
		<result property="BOROUGHCODE" column="BOROUGHCODE"/>
		<result property="BOROUGHNAME" column="BOROUGHNAME"/>
		<result property="ADDRESS" column="ADDRESS"/>
		<result property="KNAME" column="KNAME"/>
		<result property="BRANCHCODE" column="BRANCHCODE"/>
		<result property="BRANCHNAME" column="BRANCHNAME"/>
		<result property="DEPTCODE" column="DEPTCODE"/>
		<result property="DEPTNAME" column="DEPTNAME"/>
		<result property="MNGRNAME" column="MNGRNAME"/>
	</resultMap>

	<select id="selectListSA012012" resultMap="SA012012Data">
		/* SA012012.selectListSA012012 */		
		SELECT A.SALEID
			, A.SALEDATE
		    , A.SALEGUBUN
		    , fn_codename('01', '007', A.SALEGUBUN) AS SALEGUBUNNAME
			, A.SALERCD
		    , A.CONNAME
		    , A.CONM2
		    , A.CONPY
		    
		    , B.SALEDANGA
		    , B.SELLAMT		    
		    , B.REGYN
		    , CASE B.REGYN
				WHEN 'Y' THEN '등기'
				WHEN 'N' THEN '미등기'
				ELSE ''
			  END AS REGNAME
		    , B.REGDATE
		    , C.BUYGUBUN
		    , fn_codename('01', '014', C.BUYGUBUN) AS BUYGUBUNNAME
		    , C.CITYCODE
		    , fn_codename('03', C.CITYCODE, NULL) AS CITYNAME
		    , C.BOROUGHCODE
		    , (SELECT BOROUGHNAME FROM ba_citydtl WHERE CITYCODE = C.CITYCODE AND BOROUGHCODE = C.BOROUGHCODE) AS BOROUGHNAME
		    , C.ADDRESS    
		    , D.KNAME
		    , D.BRANCHCODE
		    , fn_codename('02', D.BRANCHCODE, NULL) AS BRANCHNAME
		    , D.DEPTCODE
		    , fn_codename('05', D.DEPTCODE, NULL) AS DEPTNAME
		    , (SELECT KNAME FROM hr_insamst WHERE DEPTCODE = D.DEPTCODE AND GRADE = '007' AND DUTY = '002' LIMIT 1) AS MNGRNAME
		FROM sa_salemst A
			INNER JOIN sa_saledtl B
				ON A.SALEID = B.SALEID
			INNER JOIN mm_buymst C
				ON A.BUYID = C.BUYID
			LEFT OUTER JOIN hr_insamst D
				ON A.SALERCD = D.INSACODE
		WHERE A.SALEID NOT IN (SELECT SALEID FROM sa_salehistorytb WHERE CHGGUBUN = '004')
			AND A.SALEDATE BETWEEN #S_SALEDATE_FR# AND #S_SALEDATE_TO#
		    <isNotEmpty property="S_REGYN">
		    	<isNotEqual property="S_REGYN" compareValue="ALL">
		    	AND B.REGYN = #S_REGYN#
		    	</isNotEqual>
		    </isNotEmpty>
		    <isNotEmpty property="S_BUYGUBUN">
		    	<isNotEqual property="S_BUYGUBUN" compareValue="ALL">
		    	AND C.BUYGUBUN = #S_BUYGUBUN#
		    	</isNotEqual>
		    </isNotEmpty>
		ORDER BY B.REGDATE DESC	
	</select>

</sqlMap>  