<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="SA011001">
	<typeAlias alias="SA011001VO" type="kr.co.jmena.www.web.home.saleMng.Vo.SA011001VO"/>

	<resultMap id="saleMstDataList" class="SA011001VO">
		<result property="SALEID"		column="SALEID"/>
		<result property="SALEDATE"		column="SALEDATE"/>
		<result property="MANAGENO"		column="MANAGENO"/>
		<result property="CITYCODE"		column="CITYCODE"/>
		<result property="BRANCHCODE"	column="BRANCHCODE"/>
		<result property="ADDRESS"		column="ADDRESS"/>
		<result property="OWNERNAME"	column="OWNERNAME"/>
		<result property="OWNERJUMINID"	column="OWNERJUMINID"/>
		<result property="CONBM2"		column="CONBM2"/>
		<result property="CONJM2"		column="CONJM2"/>
		<result property="CONBPY"		column="CONBPY"/>
		<result property="CONJPY"		column="CONJPY"/>
		<result property="SALEGUBUN"	column="SALEGUBUN"/>
		<result property="SALERCD"		column="SALERCD"/>
		<result property="BUYID"		column="BUYID"/>
		<result property="CONNAME"		column="CONNAME"/>
		<result property="CONJUMINID"	column="CONJUMINID"/>
		<result property="CONADDRESS"	column="CONADDRESS"/>
		<result property="CONTELNO"		column="CONTELNO"/>
		<result property="CONM2"		column="CONM2"/>
		<result property="CONPY"		column="CONPY"/>
		<result property="REMARK"		column="REMARK"/>
		<result property="SALEAMT"		column="SALEAMT"/>
		<result property="SALEDANGA"	column="SALEDANGA"/>
		<result property="DCGUBUN"		column="DCGUBUN"/>
		<result property="DCRATE"		column="DCRATE"/>
		<result property="DCAMT"		column="DCAMT"/>
		<result property="SELLAMT"		column="SELLAMT"/>
		<result property="AGENCYAMT"	column="AGENCYAMT"/>
		<result property="JOINYN"		column="JOINYN"/>
		<result property="REGYN"		column="REGYN"/>
		<result property="REGDATE"		column="REGDATE"/>
		<result property="CANCELYN"		column="CANCELYN"/>
		<result property="CANCELDATE"	column="CANCELDATE"/>
	</resultMap>

	<select id="selectListEanSaleMst" resultMap="saleMstDataList">
		SELECT
			T3.MANAGENO, T3.CITYCODE, 
			(SELECT IN1.BRANCHCODE FROM hr_insamst IN1 WHERE IN1.INSACODE = T1.SALERCD) AS BRANCHCODE, 
			T3.ADDRESS, T3.OWNERNAME, T3.OWNERJUMINID,
			CAST(ROUND(((SELECT IFNULL(SUM(IN4.CONM2), 0) AS CONM2 FROM sa_salemst IN4 WHERE IN4.BUYID = T1.BUYID) + (SELECT IFNULL(SUM(IN3.HOLDINGM2), 0) AS HOLDINGM2 FROM mm_salesopentb IN3 WHERE IN3.BUYID = T1.BUYID)), 2) AS CHAR) AS CONBM2,
			CAST(ROUND(((SELECT IFNULL(IN2.BUYM2, 0) AS BUYM2 FROM mm_buymst IN2 WHERE IN2.BUYID = T1.BUYID) - ((SELECT IFNULL(SUM(IN4.CONM2), 0) AS CONM2 FROM sa_salemst IN4 WHERE IN4.BUYID = T1.BUYID) + (SELECT IFNULL(SUM(IN3.HOLDINGM2), 0) AS HOLDINGM2 FROM mm_salesopentb IN3 WHERE IN3.BUYID = T1.BUYID))), 2) AS CHAR) AS CONJM2,
			CAST(ROUND(((SELECT IFNULL(SUM(IN4.CONPY), 0) AS CONPY FROM sa_salemst IN4 WHERE IN4.BUYID = T1.BUYID) + (SELECT IFNULL(SUM(IN3.HOLDINGPY), 0) AS HOLDINGPY FROM mm_salesopentb IN3 WHERE IN3.BUYID = T1.BUYID)), 2) AS CHAR) AS CONBPY, 
			CAST(ROUND(((SELECT IFNULL(IN2.BUYPY, 0) AS BUYPY FROM mm_buymst IN2 WHERE IN2.BUYID = T1.BUYID) - ((SELECT IFNULL(SUM(IN4.CONPY), 0) AS CONPY FROM sa_salemst IN4 WHERE IN4.BUYID = T1.BUYID) + (SELECT IFNULL(SUM(IN3.HOLDINGPY), 0) AS HOLDINGPY FROM mm_salesopentb IN3 WHERE IN3.BUYID = T1.BUYID))), 2) AS CHAR) AS CONJPY,
			T1.SALEID, T1.SALEDATE, T1.SALEGUBUN, T1.SALERCD, T1.BUYID, T1.CONNAME, T1.CONJUMINID, T1.CONADDRESS, T1.CONTELNO, T1.CONM2, T1.CONPY,
			T1.REMARK, T2.SALEAMT, T2.SALEDANGA, T2.DCGUBUN, T2.DCRATE, T2.DCAMT, T2.SELLAMT, T2.AGENCYAMT, T2.JOINYN, T2.REGYN, T2.REGDATE, T2.CANCELYN, T2.CANCELDATE
		FROM sa_salemst T1, sa_saledtl T2, mm_buymst T3
		WHERE T1.SALEID = T2.SALEID
		AND T1.BUYID = T3.BUYID
		<isNotEmpty property="SL_SALEDATE_FR">
			<isNotEmpty property="SL_SALEDATE_FR">
				AND T1.SALEDATE BETWEEN #SL_SALEDATE_FR# AND #SL_SALEDATE_TO#   
			</isNotEmpty>	
		</isNotEmpty>
		<isNotNull property="SALERCD">
			<isNotEqual property="SALERCD" compareValue="ALL">
				AND T1.SALERCD = #SALERCD#
			</isNotEqual>
		</isNotNull>
		<isNotEmpty property="ADDRESS">
			AND T3.ADDRESS LIKE '%$ADDRESS$%'  
		</isNotEmpty>
		ORDER BY T1.SALEDATE DESC
	</select>
	
	<update id="updateEnaSaleMst">
		UPDATE sa_salemst
		SET
			SALEDATE = #SALEDATE#,
			SALEGUBUN = #SALEGUBUN#,
			SALERCD = #SALERCD#,
			BUYID = #BUYID#,
			CONNAME = #CONNAME#,
			CONJUMINID = #CONJUMINID#,
			CONADDRESS = #CONADDRESS#,
			CONTELNO = #CONTELNO#,
			CONM2 = #CONM2#,
			CONPY = #CONPY#,
			REMARK = #REMARK#,
			UPDATEUSER = #UPDATEUSER#,
			UPDATEDATE = SYSDATE()
		WHERE SALEID = #SALEID#
	</update>
	
	<insert id="insertEnaSaleMst">
		INSERT INTO sa_salemst
		(
			SALEID,
			SALEDATE,
			SALEGUBUN,
			SALERCD,
			BUYID,
			CONNAME,
			CONJUMINID,
			CONADDRESS,
			CONTELNO,
			CONM2,
			CONPY,
			REMARK,
			INSERTUSER,
			INSERTDATE
		)
		VALUES(
			#SALEID#,
			#SALEDATE#,
			#SALEGUBUN#,
			#SALERCD#,
			#BUYID#,
			#CONNAME#,
			#CONJUMINID#,
			#CONADDRESS#,
			#CONTELNO#,
			#CONM2#,
			#CONPY#,
			#REMARK#,
			#INSERTUSER#,
			SYSDATE()
		)
	</insert>

	<select id="selectListEnaSaleDtl">
		SELECT 
			T1.SALEID,
			T1.SALEAMT,
			T1.SALEDANGA,
			T1.DCGUBUN,
			T1.DCRATE,
			T1.DCAMT,
			T1.SELLAMT,
			T1.JOINYN,
			T1.REGYN,
			T1.REGDATE,
			T1.CANCELYN,
			T1.CANCELDATE
		FROM sa_saledtl T1
		WHERE 1=1
		ORDER BY T1.SALEID ASC
	</select>
	
	<update id="updateEnaSaleDtl">
		UPDATE sa_saledtl
		SET
			SALEAMT = #SALEAMT#,
			SALEDANGA = #SALEDANGA#,
			DCGUBUN = #DCGUBUN#,
			DCRATE = #DCRATE#,
			DCAMT = #DCAMT#,
			SELLAMT = #SELLAMT#,
			JOINYN = #JOINYN#,
			REGYN = #REGYN#,
			REGDATE = #REGDATE#,
			CANCELYN = #CANCELYN#,
			CANCELDATE = #CANCELDATE#
		WHERE SALEID = #SALEID#
	</update>
	
	<insert id="insertEnaSaleDtl">
		INSERT INTO sa_saledtl
		(
			SALEID,
			SALEAMT,
			SALEDANGA,
			DCGUBUN,
			DCRATE,
			DCAMT,
			SELLAMT,
			JOINYN,
			REGYN,
			REGDATE,
			CANCELYN,
			CANCELDATE
		)
		VALUES(
			#SALEID#,
			#SALEAMT#,
			#SALEDANGA#,
			#DCGUBUN#,
			#DCRATE#,
			#DCAMT#,
			#SELLAMT#,
			#JOINYN#,
			#REGYN#,
			#REGDATE#,
			#CANCELYN#,
			#CANCELDATE#
		)
	</insert>

	<select id="selectListEnaSaleISTb">
		SELECT 
			T1.SALEID,
			T1.IPGUMSEQ,
			T1.DEPOSITGUBUN,
			T1.DEPOSITDATE,
			T1.DEPOSITAMT,
			T1.DEPOSITYN,
			T1.REMARK
		FROM sa_ipgumscheduletb T1
		WHERE 1=1
		AND T1.SALEID = #SALEID# 
		AND T1.IPGUMSEQ = #IPGUMSEQ# 
		ORDER BY T1.SALEID ASC
	</select>
	
	<update id="updateEnaSaleISTb">
		UPDATE sa_ipgumscheduletb
		SET
			DEPOSITGUBUN = #DEPOSITGUBUN#,
			DEPOSITDATE = #DEPOSITDATE#,
			DEPOSITAMT = #DEPOSITAMT#,
			DEPOSITYN = #DEPOSITYN#,
			REMARK = #REMARK#,
			UPDATEUSER = #UPDATEUSER#,
			UPDATEDATE = #UPDATEDATE#
		WHERE SALEID = #SALEID# 
		AND IPGUMSEQ = #IPGUMSEQ# 
	</update>
	
	<insert id="insertEnaSaleISTb">
		INSERT INTO sa_ipgumscheduletb
		(
			SALEID,
			IPGUMSEQ,
			DEPOSITGUBUN,
			DEPOSITDATE,
			DEPOSITAMT,
			DEPOSITYN,
			REMARK,
			INSERTUSER,
			INSERTDATE
		)
		VALUES(
			#SALEID#,
			#IPGUMSEQ#,
			#DEPOSITGUBUN#,
			#DEPOSITDATE#,
			#DEPOSITAMT#,
			#DEPOSITYN#,
			#REMARK#,
			#INSERTUSER#,
			SYSDATE()
		)
	</insert>

	<select id="selectListEnaSaleJNTb">
		SELECT 
			T1.SALEID,
			T1.JOINTSEQ,
			T1.JOINTNAME,
			T1.JOINTJUMINID,
			T1.JOINTTELNO,
			T1.OCCUM2,
			T1.OCCUPY,
			T1.SALEAMT,
			T1.SELLDANGA,
			T1.DCGUBUN,
			T1.DCRATE,
			T1.SELLAMT,
			T1.PAPERREGYN,
			T1.REMARK
		FROM sa_jointnametb T1
		WHERE 1=1
		AND T1.SALEID = #SALEID# 
		AND T1.JOINTSEQ = #JOINTSEQ# 
		ORDER BY T1.SALEID ASC
	</select>
	
	<update id="updateEnaSaleJNTb">
		UPDATE sa_jointnametb
		SET
			JOINTNAME = #JOINTNAME#,
			JOINTJUMINID = #JOINTJUMINID#,
			JOINTTELNO = #JOINTTELNO#,
			OCCUM2 = #OCCUM2#,
			OCCUPY = #OCCUPY#,
			SALEAMT = #SALEAMT#,
			SELLDANGA = #SELLDANGA#,
			DCGUBUN = #DCGUBUN#,
			DCRATE = #DCRATE#,
			SELLAMT = #SELLAMT#,
			PAPERREGYN = #PAPERREGYN#,
			REMARK = #REMARK#,
			UPDATEUSER = #UPDATEUSER#,
			UPDATEDATE = #UPDATEDATE#
		WHERE SALEID = #SALEID# 
		AND JOINTSEQ = #JOINTSEQ# 
	</update>
	
	<insert id="insertEnaSaleJNTb">
		INSERT INTO sa_jointnametb
		(
			SALEID,
			JOINTSEQ,
			JOINTNAME,
			JOINTJUMINID,
			JOINTTELNO,
			OCCUM2,
			OCCUPY,
			SALEAMT,
			SELLDANGA,
			DCGUBUN,
			DCRATE,
			SELLAMT,
			PAPERREGYN,
			REMARK,
			INSERTUSER,
			INSERTDATE
		)
		VALUES(
			#SALEID#,
			#JOINTSEQ#,
			#JOINTNAME#,
			#JOINTJUMINID#,
			#JOINTTELNO#,
			#OCCUM2#,
			#OCCUPY#,
			#SALEAMT#,
			#SELLDANGA#,
			#DCGUBUN#,
			#DCRATE#,
			#SELLAMT#,
			#PAPERREGYN#,
			#REMARK#,
			#INSERTUSER#,
			SYSDATE()
		)
	</insert>

	<select id="selectListEnaSaleHisTb">
		SELECT 
			T1.SALEID,
			T1.SALESEQ,
			T1.CHGGUBUN,
			T1.CHGDATE,
			T1.PREM2,
			T1.PREPY,
			T1.CHGM2,
			T1.CHGPY,
			T1.REMARK
		FROM sa_salehistorytb T1
		WHERE 1=1
		AND T1.SALEID = #SALEID# 
		AND T1.SALESEQ = #SALESEQ# 
		ORDER BY T1.SALEID ASC
	</select>
	
	<update id="updateEnaSaleHisTb">
		UPDATE sa_salehistorytb
		SET
			CHGGUBUN = #CHGGUBUN#,
			CHGDATE = #CHGDATE#,
			PREM2 = #PREM2#,
			PREPY = #PREPY#,
			CHGM2 = #CHGM2#,
			CHGPY = #CHGPY#,
			REMARK = #REMARK#,
			UPDATEUSER = #UPDATEUSER#,
			UPDATEDATE = #UPDATEDATE#
		WHERE SALEID = #SALEID# 
		AND SALESEQ = #SALESEQ# 
	</update>
	
	<insert id="insertEnaSaleHisTb">
		INSERT INTO sa_salehistorytb
		(
			SALEID,
			SALESEQ,
			CHGGUBUN,
			CHGDATE,
			PREM2,
			PREPY,
			CHGM2,
			CHGPY,
			REMARK,
			INSERTUSER,
			INSERTDATE
		)
		VALUES(
			#SALEID#,
			#SALESEQ#,
			#CHGGUBUN#,
			#CHGDATE#,
			#PREM2#,
			#PREPY#,
			#CHGM2#,
			#CHGPY#,
			#REMARK#,
			#INSERTUSER#,
			SYSDATE()
		)
	</insert>
	
</sqlMap>